# Traffic R√©seau, Wireshark

## 1Ô∏è‚É£ Rappels

* **Quelle est votre adresse IP, quel est sa classe ?**

    Mon adresse ip est 192.168.0.45, c'est une ip de classe C

* **Quel est votre masque de sous r√©seau**

    Mon masque de sous r√©seau est /24, ou 255.255.255.0

* **Quel est l'adresse de votre passerelle**

    Ma passerelle est en 192.168.0.1
## 2Ô∏è‚É£ Questions

### 0Ô∏è‚É£ Quels sont les flags TCP

* Les flags sont des bit contenus dans l'ent√™te qui donnent une information sur la nature du paquet

* URG indique que le champ Pointeur de donn√©e urgente est utilis√©.
* ACK indique que le num√©ro de s√©quence pour les acquittements est valide.
* PSH indique au r√©cepteur de d√©livrer les donn√©es √† l‚Äôapplication  et de ne pas attendre le remplissage des tampons.
* RST demande la r√©initialisation de la connexion.
* SYN indique la synchronisation des num√©ros de s√©quence.
* FIN indique fin de transmission.

### 1Ô∏è‚É£ Capturer le processus DORA du DHCP

![alt text](DORA_DHCP.png "Capture DORA")

### 2Ô∏è‚É£ DHCP Starvation / DHCP snooping / Rogue DHCP 

* Une attaque DHCP Starvation est une attaque de type DoS qui vise a flooder le serveur DHCP de requ√™tes pour qu'il ai attribu√© toutes ses adresse disponible, et ainsi bloquer son fonctionnement
* Le DHCP Snooping est une fonctionnalit√© de couche 2 qui va bloquer les Offres DHCP venant d'une source suspecte et triant ses ports
* Un Rogue DHCP est un serveur DHCP qui n'a pas √©t√© install√© par l'√©quipe infrastructure, par des raisons d'innatentions ou de malveillance

### 3Ô∏è‚É£ Que se passe t-il quand on fait un ipconfig /release, et en s√©curit√©?

Lors d'un ipconfig /release, on d√©sactive l'interface r√©seau sur laquelle on est connect√©, coupant le traffic qui y passe.
En s√©curite, on s'isole du r√©seau, reduisant les risque d'attaque. Attention, on est quand m√™me branch√© physiquement au r√©seau, ce n'est pas sans faille

### 4Ô∏è‚É£ Quelle fonctionnalit√© CISCO pour pr√©munir les attaques DHCP

Le DHCP Snooping

### 5Ô∏è‚É£ Capturer une requette DNS et sa r√©ponse

![alt text](DNS_GOOGLE.png "Capture DNS")

### 6Ô∏è‚É£ DNS Spoofing, comment s'en prot√©ger ?

Le DNS Spoofing est une attaque consistant a se faire passer pour le service DNS dans un r√©seau, elle permet en suite de faire naviguer un utilisateur sur un site malveillant en changeant la r√©solution DNS.  
Pour s'en prot√©ger, il est essentiel de v√©rifier les  domaines sur lesquels ont navigue, ainsi que de ne se connecter qu'a des r√©seaux en lesquels on a confiance 


### 7Ô∏è‚É£ DNS sec / DNS over TLS / HTTPS 

* Le DNS sec, Domain Name System Security Extensions, est un moyen de s√©curiser les serveurs DNS avec une signature cryptographique

* Le DNS over TLS et HTTPS, comme leurs noms l'indiquent, sont des moyens de s√©curiser des echanges DNS en les chiffrant, emp√™chant ainsi un tierce de les lires et/ou les alterer

### 8Ô∏è‚É£ Dans quels cas trouvent t-on du DNS sous TCP

Le DNS passe sous TCP quand sa taille d√©passe les 512 bytes, ceci peut arriver du aux nouvelles fonctionnalit√©s du DNS, ou a la taille des cl√©s cryptographiques qui le s√©curisent, comme le DNSSEC

### 9Ô∏è‚É£ Capturer un flux HTTP

![alt text](HTTP_WEB.png "Capture HTTP") 

### üîü HTTP Smuggling et sa CVE

Le HTTP Smuggling est l'acte d'injecter du code HTTP dans un paquet HTTP, permettant de le faire lire un paquet contenant du code malveillant, cette technique a nottament √©t√© utilis√© pour partager la vulnerabilit√© CVE-2005-2088 qui permettais une attaque de HTTP Smuggling qui corrompais le Cache WEB et outrepassait les Pare-Feu des navigateurs

### 1Ô∏è‚É£1Ô∏è‚É£ Confidentialit√© et Authenticit√© HTTP

Le meilleur moyen de s√©curiser HTTP est de le chiffrer, si possible asymetriquement, et donc le faire passer en HTTPS, solution utilisant TLS. Pour son authenticit√©, nous pouvons v√©rifier le domaine auquel nous somme connect√©s

### 1Ô∏è‚É£2Ô∏è‚É£ Qu'est-ce qu'une PKI ?

Une PKI est une infrastructure de s√©curisation de l'int√©grit√© de certificats num√©riques, et ainsi de certifier la l√©gitimit√© des personnes, organisations, et services. Elle est constitu√©e de beaucoup d'autres √©l√©ments, le plus important √©tant l'Autorit√© de Certification, qui d√©livrera les fameux "Certificats"

### 1Ô∏è‚É£3Ô∏è‚É£ Capturer un mot de passe avec Wireshark

![alt text](HTTP_CREDENTIALS.png "Capture Credentials")

### 1Ô∏è‚É£4Ô∏è‚É£ Comment mettre en place la confidentialit√© pour ce service ? 

Pour mettre en place de la confidentialit√© pour ce service, il faudrait chiffrer nos √©changes de bout en bout, ceci via un certificat TLS, donc par du HTTPS

### 1Ô∏è‚É£5Ô∏è‚É£ Capturer un paquet TLS

![alt text](PAQUET_TLS.png "Capture Paquet TLS")

### 1Ô∏è‚É£6Ô∏è‚É£ D√©chiffrer le traffic TLS avec votre certificat

![alt text](TLS_DECRYPT.png "Capture Paquet TLS dechiffr√©")

### 1Ô∏è‚É£7Ô∏è‚É£ Autorit√© de certification racine et intermediaire

Un certificat racine est un certificat qui identifie d'autres autorit√©s de certifications (d√©l√©gu√©s) dans un mod√®le hierarchique (Une AC peut en autoriser une autre). Il est souvent contenu par d√©faut dans votre navigateur

Le certificat intermediaire agit comme "proxy" du certificat racine, pour pouvoir signer des certificats clients sans utiliser la signature du certificat racine, qui reste cach√© derri√®re plusieurs couches de s√©curit√©

### 1Ô∏è‚É£8Ô∏è‚É£ Connectez-vous sur https://taisen.fr et affichez la chaine de confiance du certificat

On peut constater que notre certificat est sign√© par Let's Encrypt, qui fournissent des certificats SSL/TLS gratuits, qui sont consid√©r√©s comme de confiance par l'autorit√© de certification racine de mon navigateur (Ici, Firefox)

![alt text](ID_CERT.png "Capture Firefox IF du certificat")

### 1Ô∏è‚É£9Ô∏è‚É£ Capturer une authentification Kerberos

Notre √©change lors d'une authentification Kerberos se compose de
![alt text](KRB5_ECHANGE.png "Capture Echange Kerberos")

Voici un exemple avec le contenu de notre r√©ponse

![alt text](DATA_KRB.png "Capture DATA Kerberos")

### 2Ô∏è‚É£0Ô∏è‚É£ Capturer une authentification RDP

![alt text](RDP_ECHANGE.png "Capture Echange RDP")

### 2Ô∏è‚É£1Ô∏è‚É£ Quelles sont les attaques connues sur NetLM ?

Les attaques connues sur NetLM sont des attaques de types Man In The Middle, interc√©ptant le traffic entre deux clients, le probl√®me viens du fait que NetLM n'es pas crypt√©, et peut donc √™tre interc√©pt√© en clair
Le NetLM pose aussi soucis car il fait des requ√®tes DNS en clair, ce qui permettrais donc a un intrus de se faire passer pour l'hote NetLM

### 2Ô∏è‚É£2Ô∏è‚É£ Capturer une authentification WinRM

![alt text](WINRM_ECHANGE.png "Capture Echange WinRM")

### 2Ô∏è‚É£3Ô∏è‚É£ Capturer une authentification SSH ou SFTP


![alt text](SSH_AUTH.png "Capture Authentification SSH")


### 2Ô∏è‚É£4Ô∏è‚É£ Intercepter un fichier au travers du protocole SMB


![alt text](SMB_FILE.png "Capture de la capture du fichier SMB")

### 2Ô∏è‚É£5Ô∏è‚É£ Comment proteger l'authenticit√© et la confidentialit√© d'un partage SMB ?


Supprimer SMB 1 pour ne passer que sous SMB 2, et si possible, supprimer SMB 2 pour ne passer que sous SMB 3, qui est chiffr√©, utilise de la signature, et utilise de l'int√©grit√© de pr√©-authentification

#

## FIN DU TP

PS : Les questions bonus sont ici les questions 16 et 25

Merci pour votre lecture

